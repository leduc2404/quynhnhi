<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chúc Mừng Sinh Nhật Quỳnh Nhi!</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.9.2/dist/confetti.browser.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/tone/14.7.77/Tone.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Dancing+Script:wght@400;700&family=Quicksand:wght@400;500;700&family=Patrick+Hand&display=swap" rel="stylesheet">
    <style>
        /* Ẩn trang chính ngay từ đầu */
        #main-content {
            display: none;
        }

        body {
            font-family: 'Quicksand', sans-serif;
            background-color: #fffafb;
            background-image: 
                linear-gradient(to bottom, #fff0f5 0%, #ffeef3 100%),
                url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="200" height="200" viewBox="0 0 200 200"><path fill="%23fce4ec" fill-opacity="0.1" d="M100 0L112.25 87.725 200 100 112.25 112.275 100 200 87.75 112.275 0 100 87.75 87.725z"/></svg>');
            background-size: cover, 200px 200px;
            background-position: center, 0 0;
            background-repeat: no-repeat, repeat;
            overflow-x: hidden;
            position: relative;
        }
        
        /* Hiệu ứng lấp lánh */
        .twinkle {
            position: absolute;
            background-color: rgba(255, 255, 255, 0.8);
            border-radius: 50%;
            animation: twinkle 3s ease-in-out infinite;
            z-index: -2;
        }

        @keyframes twinkle {
            0%, 100% { opacity: 0; transform: scale(0); }
            50% { opacity: 1; transform: scale(1); }
        }

        .font-dancing { font-family: 'Dancing Script', cursive; }
        .font-handwriting { font-family: 'Patrick Hand', cursive; }
        
        /* --- Intro Hộp quà --- */
        #intro-overlay {
            position: fixed;
            top: 0; left: 0;
            width: 100%; height: 100%;
            background-color: #fde2e9;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 10000;
            cursor: pointer;
            transition: opacity 1s ease-in-out .5s;
        }
        
        .intro-text {
            text-align: center;
            margin-bottom: 40px;
            max-width: 80%;
            transition: opacity 0.5s ease;
        }
        
        .intro-text h1 {
            font-family: 'Dancing Script', cursive;
            font-size: 2.5rem;
            color: #ec407a;
            margin-bottom: 15px;
        }
        
        .intro-text p {
            font-size: 1.2rem;
            color: #f06292;
            line-height: 1.6;
        }
        
        .gift-container {
            position: relative;
            width: 300px;
            height: 300px;
            perspective: 1000px;
            animation: floatGift 3s ease-in-out infinite;
        }
        
        @keyframes floatGift { 
            0%, 100% { transform: translateY(0); } 
            50% { transform: translateY(-20px); } 
        }
        
        .gift-box-base {
            width: 220px;
            height: 150px;
            background: linear-gradient(#f48fb1, #f8bbd0);
            position: absolute;
            bottom: 20px; left: 50%;
            transform: translateX(-50%);
            border-radius: 10px;
            box-shadow: 0 10px 20px rgba(0,0,0,0.2);
        }
        
        .gift-lid {
            width: 240px;
            height: 70px;
            background: linear-gradient(#ec407a, #f06292);
            position: absolute;
            left: 50%; top: 60px;
            transform: translateX(-50%);
            border-radius: 10px;
            transition: transform 1s cubic-bezier(0.68, -0.55, 0.27, 1.55), top 1s cubic-bezier(0.68, -0.55, 0.27, 1.55);
            z-index: 2;
        }
        
        .gift-ribbon-v {
            position: absolute;
            width: 25px;
            height: 100%;
            background: rgba(255,255,255,0.3);
            left: 50%;
            transform: translateX(-50%);
        }
        
        .gift-bow {
            position: absolute;
            width: 120px; height: 120px;
            left: 50%; top: 0;
            transform: translateX(-50%);
            z-index: 3;
            transition: transform .5s ease, opacity .5s ease;
        }
        
        #intro-overlay.open .gift-lid { top: -150px; transform: translateX(-50%) rotate(-20deg); }
        #intro-overlay.open .gift-bow { transform: translateX(-50%) scale(0); opacity: 0; }
        
        /* --- Music Player --- */
        .music-player {
            background: white;
            border-radius: 1.5rem;
            padding: 1.5rem;
            box-shadow: 0 10px 25px -5px rgba(236, 64, 122, 0.1), 0 8px 10px -6px rgba(236, 64, 122, 0.1);
            max-width: 400px;
            margin: 0 auto 2rem auto;
            position: relative;
            overflow: hidden;
            border: 2px solid #fce4ec;
        }
        
        .music-player::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 6px;
            background: linear-gradient(90deg, #ec407a, #f8bbd0, #ec407a);
        }
        
        .progress-bar {
            background-color: #fce4ec;
            height: 8px;
            border-radius: 4px;
            cursor: pointer;
            margin-top: 1rem;
        }
        
        .progress {
            background-color: #f06292;
            height: 100%;
            border-radius: 4px;
        }
        
        .player-controls button.play-btn {
            background-color: #f06292;
            color: white;
            width: 60px;
            height: 60px;
            border-radius: 50%;
            transition: all 0.3s;
            box-shadow: 0 4px 10px rgba(244, 143, 177, 0.5);
        }
        
        .player-controls button.play-btn:hover {
            background-color: #ec407a;
            transform: scale(1.1);
        }

        /* --- Lời chúc --- */
        #showWishBtn { 
            background: #f48fb1; 
            color: white; 
            padding: 12px 24px; 
            border-radius: 50px; 
            font-weight: bold; 
            cursor: pointer; 
            transition: all 0.3s ease; 
            box-shadow: 0 4px 15px rgba(236, 64, 122, 0.3); 
            display: inline-block; 
            font-size: 1.1rem;
        }
        
        #showWishBtn:hover { 
            transform: translateY(-3px); 
            box-shadow: 0 6px 20px rgba(236, 64, 122, 0.4); 
        }
        
        #main-wish { display: none; }
        
        #main-wish.typing::after { 
            content: '|'; 
            display: inline-block; 
            animation: blink-caret 0.7s infinite; 
            color: #f48fb1; 
        }
        
        @keyframes blink-caret { 
            50% { opacity: 0; } 
        }

        /* --- Lịch --- */
        .calendar-container { 
            width: 100%; 
            max-width: 380px; 
            position: relative;
        }
        
        .date-26-wrapper { 
            position: relative; 
            width: 40px; 
            height: 40px; 
            display: flex; 
            align-items: center; 
            justify-content: center; 
        }
        
        .static-heart { 
            position: absolute; 
            width: 100%; 
            height: 100%; 
            display: flex; 
            align-items: center; 
            justify-content: center; 
            color: #f48fb1; 
            animation: pulse 2s infinite;
        }
        
        .static-heart-icon { 
            width: 100%; 
            height: 100%; 
        }
        
        .date-number { 
            position: relative; 
            z-index: 1; 
            font-weight: bold; 
            color: white; 
            font-size: 1.1rem; 
        }
        
        .blinking-heart-outline { 
            position: absolute; 
            top: 50%; 
            left: 50%; 
            width: 150%; 
            height: 150%; 
            transform: translate(-50%, -50%); 
            animation: blink-heart 1.5s ease-in-out infinite; 
            color: #f8bbd0; 
        }
        
        @keyframes pulse {
            0% { transform: scale(1); opacity: 0.8; }
            50% { transform: scale(1.1); opacity: 1; }
            100% { transform: scale(1); opacity: 0.8; }
        }
        
        @keyframes blink-heart {
            0%, 100% { 
                transform: translate(-50%, -50%) scale(1); 
                opacity: 0.5; 
            }
            50% { 
                transform: translate(-50%, -50%) scale(1.1); 
                opacity: 1; 
            }
        }
        
        /* --- Khoảnh khắc --- */
        .moments-gallery {
            position: relative;
            width: 100%;
            max-width: 500px;
            height: 220px;
            margin: 3rem auto 0 auto;
        }
        
        .moment-photo {
            position: absolute;
            width: 120px;
            height: 168px;
            background-color: white;
            padding: 8px;
            border-radius: 4px;
            box-shadow: 0 6px 18px rgba(0,0,0,0.15);
            transition: transform 0.4s ease, box-shadow 0.4s ease;
            cursor: pointer;
        }
        
        .moment-photo:hover {
            box-shadow: 0 10px 25px rgba(0,0,0,0.25);
            z-index: 20 !important;
        }
        
        .moment-photo img { 
            width: 100%; 
            height: 100%; 
            object-fit: cover; 
        }
        
        .moment-photo:nth-child(1) {
            top: 0;
            left: 10%;
            transform: rotate(-12deg);
            z-index: 1;
        }
        
        .moment-photo:nth-child(2) {
            top: 20px;
            left: 50%;
            transform: translateX(-50%) scale(1.15);
            z-index: 2;
        }
        
        .moment-photo:nth-child(3) {
            top: 5px;
            right: 10%;
            transform: rotate(10deg);
            z-index: 1;
        }

        @media (min-width: 768px) {
            .moments-gallery { height: 320px; max-width: 600px; }
            .moment-photo { width: 200px; height: 280px; padding: 12px; }
            .moment-photo:nth-child(1) { left: 5%; }
            .moment-photo:nth-child(3) { right: 5%; }
        }

        /* --- Image Lightbox --- */
        #lightbox { 
            position: fixed; 
            z-index: 20000; 
            top: 0; 
            left: 0; 
            width: 100%; 
            height: 100%; 
            background-color: rgba(0,0,0,0.8); 
            display: flex; 
            align-items: center; 
            justify-content: center; 
            transition: opacity 0.3s ease; 
        }
        
        #lightbox.hidden { 
            opacity: 0; 
            pointer-events: none; 
        }
        
        #lightbox img { 
            max-width: 90%; 
            max-height: 90%; 
            border-radius: 8px; 
            box-shadow: 0 0 30px rgba(255,255,255,0.3); 
        }
        
        #lightbox-close { 
            position: absolute; 
            top: 20px; 
            right: 30px; 
            color: white; 
            font-size: 40px; 
            cursor: pointer; 
        }

        /* --- Modal & Nút Bí Mật --- */
        .modal-base { 
            transition: opacity 0.3s ease-in-out; 
        }
        
        .modal-base.hidden { 
            pointer-events: none; 
            opacity: 0; 
        }
        
        .modal-content {
            transition: transform 0.3s ease-in-out, opacity 0.3s ease-in-out;
            background-color: #fffdf9;
        }
        
        .modal-base.hidden .modal-content { 
            transform: scale(0.95); 
            opacity: 0; 
        }

        #secretModalContent {
            background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="100" height="100" viewBox="0 0 100 100"><path fill="%23f5f1ee" d="M0 0h100v1H0z" transform="translate(0 50)"/></svg>');
            border: 1px solid #e8d7d7;
            padding-bottom: 1rem;
            display: flex;
            flex-direction: column;
            max-height: 80vh;
            border-radius: 12px;
        }
        
        .secret-text-container {
            overflow-y: auto;
            flex-shrink: 1;
            padding-right: 1rem;
            scrollbar-width: none;
            -ms-overflow-style: none;
            padding: 20px;
        }
        
        .secret-text-container::-webkit-scrollbar { 
            display: none; 
        }
        
        .secret-text { 
            color: #4a423f; 
            font-size: 1.5rem; 
            line-height: 1.5; 
        }
        
        .secret-text p { 
            margin-bottom: 1.5rem; 
        }

        /* --- Hiệu ứng lắc khi nhập sai mật khẩu --- */
        @keyframes shake {
          10%, 90% { transform: translateX(-1px); }
          20%, 80% { transform: translateX(2px); }
          30%, 50%, 70% { transform: translateX(-4px); }
          40%, 60% { transform: translateX(4px); }
        }
        
        .shake {
          animation: shake 0.5s cubic-bezier(.36,.07,.19,.97) both;
        }
        
        /* --- Hộp Điều Ước --- */
        #wish-box-container {
            position: relative;
            overflow: hidden;
            max-width: 500px;
            margin: 0 auto;
            perspective: 1000px;
        }
        
        .wish-box {
            background: linear-gradient(145deg, #fff0f5, #ffeef3);
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 15px 35px rgba(244, 143, 177, 0.25);
            position: relative;
            overflow: hidden;
            transform-style: preserve-3d;
            transition: transform 0.5s ease;
        }
        
        .wish-box::before {
            content: '';
            position: absolute;
            top: -10px;
            left: -10px;
            right: -10px;
            bottom: -10px;
            background: linear-gradient(45deg, #f8bbd0, #f48fb1, #ec407a);
            z-index: -1;
            filter: blur(20px);
            opacity: 0.3;
            border-radius: 30px;
        }
        
        .wish-box::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 10px;
            background: linear-gradient(90deg, #ec407a, #f8bbd0, #ec407a);
            border-radius: 20px 20px 0 0;
        }
        
        .wish-box-header {
            text-align: center;
            margin-bottom: 25px;
            position: relative;
        }
        
        .wish-box-header h3 {
            font-family: 'Dancing Script', cursive;
            font-size: 2.5rem;
            color: #ec407a;
            margin-bottom: 10px;
            text-shadow: 1px 1px 3px rgba(0,0,0,0.1);
        }
        
        .wish-box-header::after {
            content: '';
            display: block;
            width: 80px;
            height: 3px;
            background: linear-gradient(to right, #f8bbd0, #ec407a, #f8bbd0);
            margin: 10px auto;
            border-radius: 3px;
        }
        
        @keyframes flyUp {
            0% {
                transform: translateY(0) translateX(0) scale(0.5) rotate(0deg);
                opacity: 1;
            }
            50% {
                transform: translateY(-100px) translateX(var(--fly-x-drift, 0px)) scale(1.2) rotate(var(--fly-rotation, 0deg));
                opacity: 0.8;
            }
            100% {
                transform: translateY(-250px) translateX(calc(var(--fly-x-drift, 0px) * 1.5)) scale(1.8) rotate(calc(var(--fly-rotation, 0deg) * 2));
                opacity: 0;
            }
        }
        
        .flying-heart {
            position: absolute;
            bottom: 60px;
            left: 50%;
            pointer-events: none;
            font-size: 28px;
            animation-name: flyUp;
            animation-timing-function: ease-out;
            animation-fill-mode: forwards;
            transform-origin: center center;
            z-index: 5;
        }
        
        /* --- Thiết kế mới cho Góc Động Viên --- */
        .encouragement-container {
            background-color: #fffde7;
            border-radius: 12px;
            padding: 25px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.1);
            position: relative;
            max-width: 600px;
            margin: 0 auto;
            border-left: 5px solid #ffd54f;
            font-family: 'Patrick Hand', cursive;
            transform: rotate(-1deg);
        }
        
        .encouragement-container::before {
            content: '';
            position: absolute;
            top: -15px;
            right: 30px;
            width: 50px;
            height: 50px;
            background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="%23ffd54f"><path d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z"/></svg>');
            background-size: contain;
            opacity: 0.2;
        }
        
        .encouragement-container h3 {
            font-family: 'Dancing Script', cursive;
            font-size: 2.5rem;
            color: #f57c00;
            margin-bottom: 15px;
            text-align: center;
        }
        
        /* --- Thiết kế mới cho Bói Vui --- */
        .fortune-container {
            background: linear-gradient(135deg, #e1bee7, #ce93d8);
            border-radius: 16px;
            padding: 25px;
            box-shadow: 0 15px 35px rgba(156, 39, 176, 0.2);
            position: relative;
            max-width: 600px;
            margin: 0 auto;
            transform: rotate(1deg);
            overflow: hidden;
            perspective: 1000px;
            transition: transform 0.5s ease;
        }
        
        .fortune-container:hover {
            transform: rotate(0deg) translateY(-5px);
        }
        
        .fortune-container::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="100" height="100" viewBox="0 0 100 100"><path d="M20,20 Q40,5 60,20 T100,20 Q95,40 100,60 T100,100 Q80,95 60,100 T20,100 Q5,80 20,60 T20,20Z" fill="none" stroke="white" stroke-width="1" opacity="0.1"/></svg>');
            background-size: 150px 150px;
            opacity: 0.3;
        }
        
        .fortune-container h3 {
            font-family: 'Dancing Script', cursive;
            font-size: 2.5rem;
            color: #4a148c;
            margin-bottom: 15px;
            text-align: center;
            text-shadow: 1px 1px 2px rgba(255,255,255,0.5);
        }
        
        .fortune-container::after {
            content: '🔮';
            position: absolute;
            bottom: -15px;
            right: -15px;
            font-size: 4rem;
            opacity: 0.1;
            transform: rotate(15deg);
        }
        
        /* --- Nút Lên Đầu Trang --- */
        #back-to-top {
            position: fixed;
            bottom: 30px;
            right: 30px;
            width: 50px;
            height: 50px;
            background-color: #f48fb1;
            color: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            box-shadow: 0 4px 10px rgba(244, 143, 177, 0.5);
            transition: all 0.3s ease;
            z-index: 1000;
            opacity: 0;
            transform: translateY(20px);
            visibility: hidden;
        }
        
        #back-to-top.visible {
            opacity: 1;
            transform: translateY(0);
            visibility: visible;
        }
        
        #back-to-top:hover {
            background-color: #ec407a;
            transform: translateY(-5px);
            box-shadow: 0 6px 15px rgba(236, 64, 122, 0.6);
        }
        
        /* --- Tooltip --- */
        .tooltip {
            position: relative;
            display: inline-block;
        }
        
        .tooltip .tooltip-text {
            visibility: hidden;
            width: 180px;
            background-color: #333;
            color: #fff;
            text-align: center;
            border-radius: 6px;
            padding: 8px;
            position: absolute;
            z-index: 1;
            bottom: 125%;
            left: 50%;
            transform: translateX(-50%);
            opacity: 0;
            transition: opacity 0.3s;
            font-size: 14px;
        }
        
        .tooltip:hover .tooltip-text {
            visibility: visible;
            opacity: 1;
        }
        
        .tooltip .tooltip-text::after {
            content: "";
            position: absolute;
            top: 100%;
            left: 50%;
            margin-left: -5px;
            border-width: 5px;
            border-style: solid;
            border-color: #333 transparent transparent transparent;
        }
        
        /* --- Hiệu ứng hào quang --- */
        .halo {
            position: absolute;
            top: -10px;
            left: -10px;
            right: -10px;
            bottom: -10px;
            border-radius: 20px;
            background: radial-gradient(circle, rgba(255,255,255,0.5) 0%, rgba(255,255,255,0) 70%);
            z-index: -1;
            animation: halo-pulse 3s infinite;
        }
        
        @keyframes halo-pulse {
            0% { opacity: 0.5; }
            50% { opacity: 0.8; }
            100% { opacity: 0.5; }
        }
        
        /* --- Hiệu ứng chữ sáng --- */
        .glow-text {
            text-shadow: 0 0 10px rgba(255,255,255,0.8), 
                         0 0 20px rgba(255,255,255,0.6), 
                         0 0 30px rgba(255,255,255,0.4);
            transition: text-shadow 0.3s;
        }
        
        .glow-text:hover {
            text-shadow: 0 0 15px rgba(255,255,255,1), 
                         0 0 30px rgba(255,255,255,0.8), 
                         0 0 45px rgba(255,255,255,0.6);
        }
        
        /* --- Nâng cấp: Hiệu ứng tên Quỳnh Nhi --- */
        #birthday-girl {
            position: relative;
            display: inline-block;
            cursor: pointer;
            transition: transform 0.3s ease;
        }
        
        #birthday-girl:hover {
            transform: scale(1.05);
        }
        
        #birthday-girl::after {
            content: '';
            position: absolute;
            bottom: -5px;
            left: 0;
            width: 100%;
            height: 3px;
            background: linear-gradient(90deg, #ec407a, #f8bbd0, #ec407a);
            transform: scaleX(0);
            transform-origin: bottom right;
            transition: transform 0.3s ease;
        }
        
        #birthday-girl:hover::after {
            transform: scaleX(1);
            transform-origin: bottom left;
        }
        
        /* --- Trò chơi thổi nến --- */
        .candle-game-container {
            background: linear-gradient(145deg, #fff0f5, #ffeef3);
            border-radius: 20px;
            padding: 30px;
            margin: 2rem auto;
            max-width: 500px;
            text-align: center;
            box-shadow: 0 15px 35px rgba(244, 143, 177, 0.25);
            position: relative;
        }
        
        .cake {
            position: relative;
            width: 200px;
            height: 120px;
            margin: 0 auto;
            background: #f8d7da;
            border-radius: 50% 50% 0 0;
        }
        
        .candle {
            position: absolute;
            bottom: 100%;
            width: 8px;
            height: 40px;
            background: white;
            border-radius: 4px 4px 0 0;
        }
        
        .flame {
            position: absolute;
            bottom: 100%;
            width: 12px;
            height: 24px;
            background: linear-gradient(to top, #ff9900, #ffcc00, #ffff00);
            border-radius: 50% 50% 20% 20%;
            animation: flicker 0.5s infinite alternate;
            box-shadow: 0 0 10px #ffcc00;
            transition: all 0.3s ease;
        }
        
        @keyframes flicker {
            0% { transform: scale(1); opacity: 0.8; }
            100% { transform: scale(1.1); opacity: 1; }
        }
        
        .blow-instruction {
            font-size: 1.2rem;
            color: #ec407a;
            margin-bottom: 15px;
            font-weight: bold;
        }
        
        .candle-counter {
            font-size: 1.2rem;
            margin-top: 15px;
            color: #f57c00;
            font-weight: bold;
        }
        
        /* Microphone status */
        .mic-status {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            margin-top: 15px;
        }
        
        .mic-icon {
            width: 30px;
            height: 30px;
            background-color: #f48fb1;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 16px;
            transition: background-color 0.3s;
        }
        
        .mic-icon.active {
            background-color: #ec407a;
            animation: pulse 1s infinite;
        }
        
        /* Tăng cỡ chữ góc động viên */
        #encouragementText {
            font-size: 1.2rem;
        }
        
        /* Button tinh tế */
        .btn {
            transition: all 0.3s ease;
            cursor: pointer;
            position: relative;
            overflow: hidden;
        }
        
        .btn:after {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 5px;
            height: 5px;
            background: rgba(255, 255, 255, 0.5);
            opacity: 0;
            border-radius: 100%;
            transform: scale(1, 1) translate(-50%);
            transform-origin: 50% 50%;
        }
        
        .btn:focus:not(:active)::after {
            animation: ripple 1s ease-out;
        }
        
        @keyframes ripple {
            0% {
                transform: scale(0, 0);
                opacity: 0.5;
            }
            100% {
                transform: scale(50, 50);
                opacity: 0;
            }
        }
        
        /* Thanh đo lực thổi */
        .blow-meter {
            width: 100%;
            height: 20px;
            background: #fce4ec;
            border-radius: 10px;
            margin: 15px 0;
            position: relative;
            overflow: hidden;
            display: none; /* Ẩn ban đầu */
        }
        
        .blow-level {
            height: 100%;
            width: 0;
            background: linear-gradient(to right, #4CAF50, #FFC107, #FF5722);
            border-radius: 10px;
            transition: width 0.1s ease-out;
        }
        
        .blow-threshold {
            position: absolute;
            top: 0;
            height: 100%;
            width: 2px;
            background: rgba(0,0,0,0.5);
        }
        
        .blow-threshold:nth-child(2) {
            left: 33.33%;
        }
        
        .blow-threshold:nth-child(3) {
            left: 66.66%;
        }
        
        .blow-result {
            min-height: 24px;
            margin-top: 10px;
            font-weight: bold;
        }
    </style>
</head>
<body class="text-gray-700">
    <!-- Màn hình chờ hộp quà -->
    <div id="intro-overlay">
        <div class="intro-text">
            <h1>Nhấn vào để thấy điều bất ngờ</h1>
            <p></p>
        </div>
        <div class="gift-container">
            <div class="gift-bow">
                 <svg viewBox="0 0 100 100"><path d="M 50 50 C 30 -10, 0 10, 40 50 L 50 60 Z" fill="#f06292"/><path d="M 50 50 C 70 -10, 100 10, 60 50 L 50 60 Z" fill="#f06292"/><circle cx="50" cy="50" r="15" fill="#fce4ec"/></svg>
            </div>
            <div class="gift-lid"></div>
            <div class="gift-box-base">
                <div class="gift-ribbon-v"></div>
            </div>
        </div>
    </div>

    <!-- Nội dung chính -->
    <main id="main-content">
        <div class="container mx-auto px-4 py-8 md:py-16 max-w-5xl">
            <header class="text-center mb-12">
                <h1 class="font-dancing text-5xl md:text-7xl text-pink-500 mb-2">Happy Birthday</h1>
                <h2 id="birthday-girl" class="text-3xl md:text-4xl font-bold text-pink-400 glow-text">Lê Quỳnh Nhi</h2>
                <div class="signature"></div>
            </header>

            <!-- Ảnh và Lịch -->
            <section class="flex flex-col lg:flex-row items-center justify-center gap-8 md:gap-12 mb-20">
                <div class="main-photo-container w-64 h-80 md:w-80 md:h-[420px] rounded-lg bg-white p-4 shadow-xl transform -rotate-3 transition-transform hover:rotate-0 hover:scale-105">
                    <img src=1.jpg alt="Ảnh của Lê Quỳnh Nhi" class="w-full h-full object-cover border-2 border-gray-100">
                </div>
                <div class="bg-white p-6 rounded-xl shadow-lg text-center calendar-container">
                    <div class="halo"></div>
                    <h3 class="font-bold text-3xl text-pink-500 mb-4 border-b-2 border-dotted border-pink-200 pb-2">Tháng 7, 2025</h3>
                    <div class="grid grid-cols-7 gap-y-3 gap-x-2 text-base place-items-center">
                        <span class="text-gray-400 font-bold">T2</span><span class="text-gray-400 font-bold">T3</span><span class="text-gray-400 font-bold">T4</span><span class="text-gray-400 font-bold">T5</span><span class="text-gray-400 font-bold">T6</span><span class="text-gray-400 font-bold">T7</span><span class="text-gray-400 font-bold">CN</span>
                        <span class="text-gray-300"></span><span>1</span><span>2</span><span>3</span><span>4</span><span>5</span><span>6</span>
                        <span>7</span><span>8</span><span>9</span><span>10</span><span>11</span><span>12</span><span>13</span>
                        <span>14</span><span>15</span><span>16</span><span>17</span><span>18</span><span>19</span><span>20</span>
                        <span>21</span><span>22</span><span>23</span><span>24</span><span>25</span>
                        <div class="date-26-wrapper">
                            <div class="static-heart">
                                <svg class="static-heart-icon" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M3.172 5.172a4 4 0 015.656 0L10 6.343l1.172-1.171a4 4 0 115.656 5.656L10 17.657l-6.828-6.829a4 4 0 010-5.656z" clip-rule="evenodd"></path></svg>
                            </div>
                            <span class="date-number">26</span>
                            <div class="blinking-heart-outline">
                                <svg viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M3.172 5.172a4 4 0 015.656 0L10 6.343l1.172-1.171a4 4 0 115.656 5.656L10 17.657l-6.828-6.829a4 4 0 010-5.656z" clip-rule="evenodd"></path></svg>
                            </div>
                        </div>
                        <span>27</span><span>28</span><span>29</span><span>30</span><span>31</span>
                    </div>
                    <p class="mt-4 text-sm text-gray-500 font-dancing text-xl">Ngày đặc biệt của cậu</p>
                </div>
            </section>
            
            <!-- Music Player -->
            <section>
                 <div class="music-player">
                    <div class="mb-2 text-center">
                        <p id="song-title" class="font-bold text-gray-800 text-xl">Happy Birthday to You</p>
                        <p id="artist-name" class="text-sm text-gray-500">AMEE x Hoàng Dũng x Obito x Hứa Kim Tuyền</p>
                    </div>
                    <div class="progress-bar mb-2">
                        <div id="progress" class="progress"></div>
                    </div>
                    <div class="flex justify-between text-xs text-gray-500 mb-3">
                        <span id="current-time">0:00</span>
                        <span id="duration">0:00</span>
                    </div>
                    <div class="player-controls flex items-center justify-center gap-6">
                        <button id="play-pause-btn" class="play-btn flex items-center justify-center">
                            <svg id="play-icon" class="w-6 h-6" fill="currentColor" viewBox="0 0 20 20"><path d="M6.3 5.077a.5.5 0 01.816-.39l7.4 5.25a.5.5 0 010 .78l-7.4 5.25A.5.5 0 016.3 14.923V5.077z"/></svg>
                            <svg id="pause-icon" class="w-6 h-6 hidden" fill="currentColor" viewBox="0 0 20 20"><path d="M5.75 4.5a.75.75 0 00-.75.75v9.5c0 .414.336.75.75.75h1.5a.75.75 0 00.75-.75V5.25a.75.75 0 00-.75-.75H5.75zm6.5 0a.75.75 0 00-.75.75v9.5c0 .414.336.75.75.75h1.5a.75.75 0 00.75-.75V5.25a.75.75 0 00-.75-.75h-1.5z"/></svg>
                        </button>
                    </div>
                </div>
            </section>

            <!-- Lời chúc -->
            <section class="text-center my-16">
                <button id="showWishBtn" class="btn">💌 Nhận Lời Chúc 💌</button>
                <p id="main-wish" class="font-dancing text-3xl md:text-4xl text-gray-600 leading-relaxed max-w-2xl mx-auto min-h-[100px]"></p>
            </section>

            <!-- Hộp Điều Ước -->
            <section id="wish-box-section" class="my-16">
                <div id="wish-box-container">
                    <div class="wish-box">
                        <div class="wish-box-header">
                            <h3>Gửi Một Điều Ước... ✨</h3>
                            <p class="text-gray-500">Hãy viết điều ước cho tuổi mới của cậu vào đây, vũ trụ sẽ lắng nghe đó!</p>
                        </div>
                        <textarea id="user-wish-input" rows="3" class="w-full p-4 border-2 border-pink-200 rounded-lg focus:outline-none focus:border-pink-400 focus:ring-2 focus:ring-pink-200 transition bg-white bg-opacity-70" placeholder="Tớ ước rằng..."></textarea>
                        <button id="send-wish-btn" class="btn mt-6 bg-gradient-to-r from-pink-500 to-pink-600 hover:from-pink-600 hover:to-pink-700 text-white font-bold py-3 px-8 rounded-full hover:scale-105">
                            Gửi Tới Các Vì Sao
                        </button>
                        <p id="wish-confirmation" class="text-green-500 font-bold mt-4 h-6 text-center"></p>
                    </div>
                </div>
            </section>

            <!-- Trò chơi thổi nến -->
            <section class="candle-game-container">
                <h3 class="font-dancing text-4xl text-pink-500 mb-6">Thổi nến sinh nhật</h3>
                <p class="blow-instruction">Hãy thổi thật mạnh vào micro để thổi nến!</p>
                <div class="mic-status">
                    <div class="mic-icon">🎤</div>
                    <span id="mic-status-text">Chưa kết nối</span>
                </div>
                <!-- Thanh đo lực thổi mới -->
                <div class="blow-meter">
                    <div class="blow-level"></div>
                    <div class="blow-threshold"></div>
                    <div class="blow-threshold"></div>
                </div>
                <br>
                <br>
                <br>
                <br>
                <div class="cake">
                    <div class="candle" style="left: 30%;">
                        <div class="flame" style="left: -2px;" id="flame-1"></div>
                    </div>
                    <div class="candle" style="left: 50%;">
                        <div class="flame" style="left: -2px;" id="flame-2"></div>
                    </div>
                    <div class="candle" style="left: 70%;">
                        <div class="flame" style="left: -2px;" id="flame-3"></div>
                    </div>
                </div>
                <button id="start-mic-btn" class="btn mt-4 bg-pink-500 hover:bg-pink-600 text-white font-bold py-3 px-8 rounded-full hover:scale-105">
                    Bắt đầu Thổi
                </button>
                <p id="blow-result" class="blow-result"></p>
                <p id="candle-counter" class="candle-counter">Còn 3 cây nến cháy</p>
            </section>

            <!-- Khoảnh khắc của chúng ta -->
            <section class="mb-12" style="margin-top: 6rem;">
                <h3 class="font-dancing text-5xl text-center text-pink-500 mb-12">Khoảnh khắc của chúng ta</h3>
                <div class="moments-gallery">
                    <div class="moment-photo"><img src=3.JPG alt="Ảnh kỷ niệm 1"></div>
                    <div class="moment-photo"><img src=2.jpg alt="Ảnh kỷ niệm 2"></div>
                    <div class="moment-photo"><img src=4.jpg alt="Ảnh kỷ niệm 3"></div>
                </div>
            </section>

            <!-- Lời Động Viên Từ AI -->
            <section class="text-center mt-20">
                <div class="encouragement-container">
                    <h3 class="font-dancing">Góc Động Viên</h3>
                    <p class="text-gray-600 mb-8">Trong cuộc sống, sẽ không thể tránh khỏi những khoảnh khắc cô đơn, thất vọng,... Hãy để những lời động viên nhỏ nàyy tiếp thêm sức mạnh cho cậu</p>
                    <button id="generateEncouragementBtn" class="btn bg-yellow-500 hover:bg-yellow-600 text-white font-bold py-3 px-8 rounded-full hover:scale-105">
                        Nhận Lời Động Viên 💖
                    </button>
                    <div id="encouragementResult" class="mt-6 p-6 bg-white rounded-lg shadow-inner min-h-[120px] text-gray-700 italic flex items-center justify-center">
                        <p id="encouragementText">...</p>
                        <div id="encouragementLoading" class="hidden">
                            <div class="animate-spin rounded-full h-8 w-8 border-b-2 border-yellow-500"></div>
                        </div>
                    </div>
                </div>
            </section>
            
            <!-- Bói Vui Sinh Nhật -->
            <section class="text-center mt-20">
                <div class="fortune-container">
                    <h3 class="font-dancing">Bói Vui Tuổi Mới</h3>
                    <p class="text-gray-700 mb-8">Hé lộ một chút "thiên cơ" về tuổi 18 của cậu nào. Chỉ để cho vui thôi nhé!</p>
                    <button id="generateFortuneBtn" class="btn bg-purple-500 hover:bg-purple-600 text-white font-bold py-3 px-8 rounded-full hover:scale-105">
                        Xem Vận Mệnh Tuổi Mới! 🔮
                    </button>
                    <div id="fortuneResult" class="mt-6 p-6 bg-white rounded-lg shadow-inner min-h-[120px] text-gray-700 italic flex items-center justify-center">
                        <p id="fortuneText">...</p>
                        <div id="fortuneLoading" class="hidden">
                            <div class="animate-spin rounded-full h-8 w-8 border-b-2 border-purple-500"></div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Góc Bí Mật -->
            <section class="text-center mt-20">
                <div class="tooltip">
                    <button id="openSecretBtn" class="btn bg-transparent border-none cursor-pointer group">
                         <svg class="h-16 w-16 text-gray-400 group-hover:text-pink-400 transition-colors" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M16.5 10.5V6.75a4.5 4.5 0 10-9 0v3.75m-.75 11.25h10.5a2.25 2.25 0 002.25-2.25v-6.75a2.25 2.25 0 00-2.25-2.25H6.75a2.25 2.25 0 00-2.25 2.25v6.75a2.25 2.25 0 002.25 2.25z" />
                        </svg>
                    </button>
                    <span class="tooltip-text">Bấm để xem lời nhắn bí mật</span>
                </div>
            </section>
        </div>
    </main>
    
    <!-- Audio Element -->
    <audio id="birthday-song" src="hpbd.mp3"></audio>
    <!-- Âm thanh cho các hiệu ứng -->
    <audio id="ting-sound" src="https://assets.mixkit.co/sfx/preview/mixkit-select-click-1109.mp3"></audio>
    <audio id="paper-sound" src="https://assets.mixkit.co/sfx/preview/mixkit-page-turn-sound-1106.mp3"></audio>
    <audio id="sparkle-sound" src="https://assets.mixkit.co/sfx/preview/mixkit-magic-sparkles-3000.mp3"></audio>
    <audio id="blow-sound" src="https://assets.mixkit.co/sfx/preview/mixkit-wind-whistling-1246.mp3"></audio>
    <audio id="candle-sound" src="https://assets.mixkit.co/sfx/preview/mixkit-candle-burning-1242.mp3"></audio>

    <!-- Image Lightbox -->
    <div id="lightbox" class="hidden">
        <span id="lightbox-close">×</span>
        <img id="lightbox-image" src="" alt="Ảnh phóng to">
    </div>

    <!-- Modal Mật khẩu -->
    <div id="passwordModal" class="modal-base fixed inset-0 bg-black bg-opacity-60 flex items-center justify-center z-50 hidden">
        <div id="passwordModalContent" class="modal-content relative bg-white rounded-lg shadow-2xl p-6 md:p-8 max-w-sm w-11/12 text-center">
            <h3 class="font-dancing text-3xl text-pink-500 mb-4">Vùng An Toàn</h3>
            <p class="text-gray-600 mb-6">Vui lòng nhập mật khẩu để tiếp tục.</p>
            <div class="relative">
                <input type="password" id="passwordInput" class="w-full p-3 border-2 border-pink-200 rounded-lg text-center text-lg tracking-widest focus:outline-none focus:border-pink-400 focus:ring-2 focus:ring-pink-200 transition" placeholder="••••••••">
            </div>
            <p id="passwordError" class="text-red-500 text-sm mt-2 h-5"></p>
            <button id="submitPasswordBtn" class="btn mt-4 w-full bg-pink-500 hover:bg-pink-600 text-white font-bold py-3 px-8 rounded-full hover:scale-105">
                Mở Khóa
            </button>
            <button id="closePasswordBtn" class="absolute top-2 right-4 text-gray-400 hover:text-gray-700 text-3xl">×</button>
        </div>
    </div>

    <!-- Modal Bí Mật -->
    <div id="secretModal" class="modal-base fixed inset-0 bg-black bg-opacity-60 flex items-center justify-center z-50 hidden">
        <div id="secretModalContent" class="modal-content rounded-lg shadow-2xl p-6 md:p-8 max-w-lg w-11/12">
            <div class="flex justify-between items-center mb-4">
                <h3 class="font-dancing text-4xl text-pink-500"><strong>Một vài lời</strong></h3>
                <button id="closeSecretBtn" class="text-gray-500 hover:text-gray-800 text-3xl leading-none">×</button>
            </div>
            <div class="secret-text-container">
                <div class="font-handwriting secret-text">
                    <p>Mừng Quỳnh Nhi ngang hàng với Lê Đức hehe.</p>
                    <p>Để mà nói thì nhiều lúc t ích kỉ, t muốn nhiều hơn thế, t chẳng muốn m phải lớn lên đương đầu với những giông tố ngoài kia của cuộc sống. Nhiều lúc t chỉ muốn m mãi bé như thế, t sợ m có những mqh tốt ngoài kia rồi dần dần quên đi t. Những vấn đề của t với mqh này thì t nghĩ chắc m cũng biết. Nma dù thế nào cũng cảm ơn m vì đã làm rất tốt, vì đã ở đây đến giây phút này. T chỉ muốn nói là m rất tuyệt vời ✨</p>
                    <p>Bước sang tuổi 18 - tuổi bước ngoặt của cuộc đời, một sự khởi đầu cho hành trình trưởng thành, nơi m sẽ tự viết nên câu chuyện cuộc đời của mình, lúc m có những ước mơ, trách nhiệm và tự do. Chúc Quỳnh Nhi sức khoẻ dồi dào, ăn uống đầy đủ, học hành thuận lợi, may mắn đong đầy, vạn sự như ý, tỷ sự như mơ, triệu triệu bất ngờ và ngập tràn hành phúc 🎉</p>
                    <p>Từ ngày hôm nay m đã là 1 người lớn, có những suy nghĩ khác đi, phải đối mặt với những quyết định mang tính thay đổi cả 1 đời. Dù không thể tránh khỏi có nhiều lúc có cảm thấy bất lực, thất vọng nhưng luôn mong m có thể tự tin vào bản thân, vào trực giác của mình, có thể vững vàng đối diện với tất cả khó khăn thử thách. 
Luôn là 1 cô gái vui vẻ, yêu đời nhé 💓</p>
                    <p>Dù không biết sau này xa hay gần, mọi chuyện như thế nào nhưng t mong rằng mọi thứ luôn suôn sẻ.</p>
                    <p>Người ta nói rằng cứ một vạn chiếc cỏ ba lá, mới có một chiếc cỏ bốn lá. Giống như giữa bao nhiêu người, t với m lại gặp được nhau. T mong món quà nhỏ này luôn nhắc m hãy tin tưởng vào bản thân, sống trọn vẹn với tình yêu thương và may mắn. Hy vọng đây sẽ là 1 người bạn tinh thần, luôn bên cạnh âm thầm cổ vũ m vượt qua khó khăn. Nếu 1 ngày cảm thấy mỏi mệt, hãy nhìn chiếc vòng nhỏ này, nó sẽ thay t nhắc với m rằng: m xứng đáng với tất cả những gì có trên đời ❤️</p>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Nút Lên Đầu Trang -->
    <div id="back-to-top" class="visible">
        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 15l7-7 7 7" />
        </svg>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // Biến toàn cục lưu điều ước
            let userWish = '';
            
            // Tạo hiệu ứng lấp lánh background
            function createTwinkles() {
                const container = document.createElement('div');
                container.classList.add('twinkling-background');
                
                const numStars = 100;
                for (let i = 0; i < numStars; i++) {
                    const twinkle = document.createElement('div');
                    twinkle.classList.add('twinkle');
                    
                    // Random position
                    const x = Math.random() * 100;
                    const y = Math.random() * 100;
                    twinkle.style.left = `${x}%`;
                    twinkle.style.top = `${y}%`;
                    
                    // Random size (1px to 3px)
                    const size = Math.random() * 2 + 1;
                    twinkle.style.width = `${size}px`;
                    twinkle.style.height = `${size}px`;
                    
                    // Random animation duration and delay
                    const duration = Math.random() * 3 + 2; // 2-5s
                    const delay = Math.random() * 5;
                    twinkle.style.animationDuration = `${duration}s`;
                    twinkle.style.animationDelay = `${delay}s`;
                    
                    container.appendChild(twinkle);
                }
                
                document.body.appendChild(container);
            }
            
            createTwinkles();

            // Phát âm thanh ting
            function playTingSound() {
                const tingSound = document.getElementById('ting-sound');
                tingSound.currentTime = 0;
                tingSound.play();
            }
            
            // Phát âm thanh giấy
            function playPaperSound() {
                const paperSound = document.getElementById('paper-sound');
                paperSound.currentTime = 0;
                paperSound.play();
            }
            
            // Phát âm thanh lấp lánh
            function playSparkleSound() {
                const sparkleSound = document.getElementById('sparkle-sound');
                sparkleSound.currentTime = 0;
                sparkleSound.play();
            }
            
            // Gán âm thanh ting cho tất cả các nút
            document.querySelectorAll('button').forEach(button => {
                button.addEventListener('click', () => {
                    playTingSound();
                });
            });

            const introOverlay = document.getElementById('intro-overlay');
            const mainContent = document.getElementById('main-content');
            const showWishBtn = document.getElementById('showWishBtn');
            const wishElement = document.getElementById('main-wish');
            const wishTextContent = "Mừng Quỳnh Nhi bước sang tuổi 18 - một cột mốc đặc biệt đánh dấu cho sự khởi đầu mới. Chúc cậu luôn luôn vui vẻ, yêu đời, ngày càng thông minh, xinh đẹp và thành công trong cuộc sống 💖";
            let typewriterSynth;
            let openSound;

            // --- Xử lý mở hộp quà ---
            introOverlay.addEventListener('click', async () => {
                if (typeof Tone !== 'undefined' && Tone.context.state !== 'running') {
                    await Tone.start();
                }
                
                if (typeof Tone !== 'undefined' && !openSound) {
                    openSound = new Tone.Synth({
                        oscillator: { type: "sine" },
                        envelope: { attack: 0.005, decay: 0.1, sustain: 0.3, release: 1 },
                    }).toDestination();
                }
                if (openSound) {
                    openSound.triggerAttackRelease("C5", "0.5");
                }

                introOverlay.classList.add('open');

                // Ẩn dòng chữ "Nhấn vào để thấy điều bất ngờ"
                document.querySelector('.intro-text').style.opacity = '0';
                setTimeout(() => {
                    document.querySelector('.intro-text').style.display = 'none';
                }, 500);

                // Hiệu ứng pháo hoa
                if (typeof confetti === 'function') {
                    const end = Date.now() + (2 * 1000);
                    const colors = ['#f48fb1', '#ec407a', '#f8bbd0', '#ffffff'];

                    (function frame() {
                        confetti({
                            particleCount: 2,
                            angle: 60,
                            spread: 55,
                            origin: { x: 0 },
                            colors: colors
                        });
                        confetti({
                            particleCount: 2,
                            angle: 120,
                            spread: 55,
                            origin: { x: 1 },
                            colors: colors
                        });

                        if (Date.now() < end) {
                            requestAnimationFrame(frame);
                        }
                    }());
                }

                setTimeout(() => {
                    introOverlay.style.opacity = '0';
                    setTimeout(() => {
                        introOverlay.style.display = 'none';
                        mainContent.style.display = 'block';
                    }, 1000); 
                }, 500); 
            }, { once: true });

            // --- Xử lý nút nhận lời chúc ---
            showWishBtn.addEventListener('click', () => {
                showWishBtn.style.display = 'none';
                wishElement.style.display = 'block';
                startTypewriter();
            }, { once: true });

            // --- Hiệu ứng gõ chữ ---
            function typeWriter(element, text, speed, callback) {
                let i = 0;
                element.innerHTML = "";
                element.classList.add('typing');
                const type = () => {
                    if (i < text.length) {
                        element.innerHTML += text.charAt(i);
                        if (text.charAt(i) !== ' ' && typewriterSynth) {
                            try {
                                typewriterSynth.triggerAttackRelease("C5", "8n");
                            } catch(e) { console.error("Tone.js error:", e); }
                        }
                        i++;
                        setTimeout(type, speed);
                    } else if (callback) {
                        callback();
                    }
                };
                type();
            }
            
            function startTypewriter() {
                if (typeof Tone !== 'undefined' && !typewriterSynth) {
                    typewriterSynth = new Tone.PolySynth(Tone.Synth, {
                        oscillator: { type: 'sine' },
                        envelope: { attack: 0.005, decay: 0.1, sustain: 0.01, release: 0.1 }
                    }).toDestination();
                }
                typeWriter(wishElement, wishTextContent, 80, () => {
                    wishElement.classList.remove('typing');
                });
            }

            // --- Hộp Điều Ước ---
            const sendWishBtn = document.getElementById('send-wish-btn');
            const wishInput = document.getElementById('user-wish-input');
            const wishBoxContainer = document.getElementById('wish-box-container');
            const wishConfirmation = document.getElementById('wish-confirmation');

            sendWishBtn.addEventListener('click', () => {
                if (wishInput.value.trim() === '') {
                    wishInput.focus();
                    return;
                }
                
                // Lưu điều ước vào biến toàn cục
                userWish = wishInput.value.trim();
                
                // Phát âm thanh ting
                playTingSound();
                
                // Tạo hiệu ứng trái tim bay
                for (let i = 0; i < 15; i++) {
                    createFlyingHeart();
                }
                
                // Phát âm thanh lấp lánh
                playSparkleSound();

                wishInput.value = '';
                wishConfirmation.textContent = '';
            });

            function createFlyingHeart() {
                const heart = document.createElement('div');
                heart.classList.add('flying-heart');
                heart.innerHTML = ['💖', '❤️', '💕', '✨', '⭐'][Math.floor(Math.random() * 5)];
                
                // Random hóa đường bay và góc xoay
                const xDrift = (Math.random() - 0.5) * 100;
                const rotation = (Math.random() - 0.5) * 40;
                
                heart.style.setProperty('--fly-x-drift', `${xDrift}px`);
                heart.style.setProperty('--fly-rotation', `${rotation}deg`);

                heart.style.left = `${Math.random() * 80 + 10}%`;
                heart.style.animationDuration = `${Math.random() * 2 + 2}s`;
                heart.style.animationDelay = `${Math.random() * 0.5}s`;
                heart.style.color = ['#f48fb1', '#ec407a', '#f8bbd0', '#ffc107'][Math.floor(Math.random() * 4)];

                wishBoxContainer.appendChild(heart);

                // Dọn dẹp trái tim sau khi bay xong
                setTimeout(() => {
                    heart.remove();
                }, 4500); 
            }

            // --- Lời Động Viên Từ AI ---
            const generateEncouragementBtn = document.getElementById('generateEncouragementBtn');
            const encouragementTextP = document.getElementById('encouragementText');
            const encouragementLoading = document.getElementById('encouragementLoading');

            generateEncouragementBtn.addEventListener('click', async () => {
                encouragementTextP.classList.add('hidden');
                encouragementLoading.classList.remove('hidden');
                generateEncouragementBtn.disabled = true;
                generateEncouragementBtn.innerHTML = 'Đang viết...';

                const prompt = 'Viết một lời động viên ngắn gọn, chân thành gửi đến Quỳnh Nhi. Dùng từ ngữ đơn giản, tự nhiên, kèm theo một vài emoji động viên dễ thương. Không thêm hướng dẫn hay chú thích.';
                
                try {
                    const generatedText = await callGeminiAPI(prompt);
                    encouragementTextP.textContent = `"${generatedText}"`;
                } catch (error) {
                    console.error("Error calling Gemini API for encouragement:", error);
                    encouragementTextP.textContent = "Oops! Có lỗi xảy ra. Nhưng hãy luôn nhớ rằng cậu rất tuyệt vời!";
                } finally {
                    encouragementLoading.classList.add('hidden');
                    encouragementTextP.classList.remove('hidden');
                    generateEncouragementBtn.disabled = false;
                    generateEncouragementBtn.innerHTML = 'Nhận Lời Động Viên Khác 💖';
                }
            });
            
            // --- Bói Vui Sinh Nhật ---
            const generateFortuneBtn = document.getElementById('generateFortuneBtn');
            const fortuneTextP = document.getElementById('fortuneText');
            const fortuneLoading = document.getElementById('fortuneLoading');

            generateFortuneBtn.addEventListener('click', async () => {
                fortuneTextP.classList.add('hidden');
                fortuneLoading.classList.remove('hidden');
                generateFortuneBtn.disabled = true;
                generateFortuneBtn.innerHTML = 'Đang gieo quẻ...';

                const prompt = 'Viết một lời tiên tri sinh nhật vui vẻ, hài hước, lạc quan cho một người bạn tên Quỳnh Nhi vừa tròn 18 tuổi. Giọng văn thân thiện, dí dỏm, mang tính tích cực. Không cần quá dài. Ví dụ: "Vũ trụ thì thầm rằng năm nay ví của bạn sẽ dày hơn một chút, và bụng sẽ vui hơn rất nhiều vì trà sữa!" hoặc "Một chuyến đi bất ngờ đang chờ đón bạn đó nha!". Kèm sticker phù hợp. Không thêm chú thích hay ký tự markdown.';
                
                try {
                    const generatedText = await callGeminiAPI(prompt);
                    fortuneTextP.textContent = `"${generatedText}"`;
                } catch (error) {
                    console.error("Error calling Gemini API for fortune:", error);
                    fortuneTextP.textContent = "Quẻ bói hôm nay bị lỗi... Nhưng chắc chắn tuổi mới của cậu sẽ toàn là chuyện vui thôi!";
                } finally {
                    fortuneLoading.classList.add('hidden');
                    fortuneTextP.classList.remove('hidden');
                    generateFortuneBtn.disabled = false;
                    generateFortuneBtn.innerHTML = 'Xem Vận Mệnh Tuổi Mới! 🔮';
                }
            });
            
            // Hàm gọi API chung
            async function callGeminiAPI(promptText) {
                let chatHistory = [{ role: "user", parts: [{ text: promptText }] }];
                const payload = { contents: chatHistory };
                const apiKey = "AIzaSyDLbXYlcOqZQPBIE8UwiUvEgKLVeS2WkhA";
                const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash:generateContent?key=${apiKey}`;
                
                const response = await fetch(apiUrl, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });

                if (!response.ok) throw new Error(`API call failed: ${response.status}`);

                const result = await response.json();
                if (result.candidates?.[0]?.content?.parts?.[0]) {
                    return result.candidates[0].content.parts[0].text.replace(/\*\*/g, '');
                }
                throw new Error("No content generated");
            }

            // --- Xử lý Vùng An Toàn (Mật khẩu & Modal) ---
            const openSecretBtn = document.getElementById('openSecretBtn');
            const secretModal = document.getElementById('secretModal');
            const closeSecretBtn = document.getElementById('closeSecretBtn');
            const passwordModal = document.getElementById('passwordModal');
            const passwordModalContent = document.getElementById('passwordModalContent');
            const closePasswordBtn = document.getElementById('closePasswordBtn');
            const passwordInput = document.getElementById('passwordInput');
            const submitPasswordBtn = document.getElementById('submitPasswordBtn');
            const passwordError = document.getElementById('passwordError');
            
            const correctPassword = '26072007';

            openSecretBtn.addEventListener('click', () => {
                passwordModal.classList.remove('hidden');
                passwordInput.focus();
            });

            function closePasswordModal() {
                passwordModal.classList.add('hidden');
                passwordError.textContent = '';
                passwordInput.value = '';
            }
            closePasswordBtn.addEventListener('click', closePasswordModal);
            passwordModal.addEventListener('click', (e) => {
                if (e.target === passwordModal) {
                    closePasswordModal();
                }
            });

            function checkPassword() {
                if (passwordInput.value === correctPassword) {
                    closePasswordModal();
                    setTimeout(() => {
                        secretModal.classList.remove('hidden');
                        playPaperSound();
                    }, 100); 
                } else {
                    passwordError.textContent = 'Mật khẩu không đúng. Thử lại nhé!';
                    passwordModalContent.classList.add('shake');
                    passwordInput.value = '';
                    passwordInput.focus();
                    setTimeout(() => {
                        passwordModalContent.classList.remove('shake');
                    }, 500);
                }
            }
            submitPasswordBtn.addEventListener('click', checkPassword);
            passwordInput.addEventListener('keydown', (e) => {
                if (e.key === 'Enter') {
                    checkPassword();
                }
            });

            closeSecretBtn.addEventListener('click', () => {
                secretModal.classList.add('hidden');
            });
            secretModal.addEventListener('click', (e) => {
                if (e.target === secretModal) {
                    secretModal.classList.add('hidden');
                }
            });

            // --- Image Lightbox ---
            const lightbox = document.getElementById('lightbox');
            const lightboxImage = document.getElementById('lightbox-image');
            const lightboxClose = document.getElementById('lightbox-close');
            const galleryImages = document.querySelectorAll('.moment-photo img');

            galleryImages.forEach(image => {
                image.addEventListener('click', () => {
                    lightboxImage.src = image.src;
                    lightbox.classList.remove('hidden');
                });
            });

            lightboxClose.addEventListener('click', () => {
                lightbox.classList.add('hidden');
            });

             lightbox.addEventListener('click', (e) => {
                if (e.target === lightbox) {
                    lightbox.classList.add('hidden');
                }
            });

            // --- Music Player Logic ---
            const audio = document.getElementById('birthday-song');
            const playPauseBtn = document.getElementById('play-pause-btn');
            const playIcon = document.getElementById('play-icon');
            const pauseIcon = document.getElementById('pause-icon');
            const progressBar = document.querySelector('.progress-bar');
            const progress = document.getElementById('progress');
            const currentTimeEl = document.getElementById('current-time');
            const durationEl = document.getElementById('duration');

            function formatTime(seconds) {
                const minutes = Math.floor(seconds / 60);
                const secs = Math.floor(seconds % 60);
                return `${minutes}:${secs < 10 ? '0' : ''}${secs}`;
            }

            playPauseBtn.addEventListener('click', () => {
                if (audio.paused) {
                    audio.play();
                    playIcon.classList.add('hidden');
                    pauseIcon.classList.remove('hidden');
                } else {
                    audio.pause();
                    playIcon.classList.remove('hidden');
                    pauseIcon.classList.add('hidden');
                }
            });

            audio.addEventListener('timeupdate', () => {
                const { currentTime, duration } = audio;
                if (duration) {
                    const progressPercent = (currentTime / duration) * 100;
                    progress.style.width = `${progressPercent}%`;
                    currentTimeEl.textContent = formatTime(currentTime);
                }
            });

            audio.addEventListener('loadedmetadata', () => {
                durationEl.textContent = formatTime(audio.duration);
            });

            progressBar.addEventListener('click', (e) => {
                const width = progressBar.clientWidth;
                const clickX = e.offsetX;
                const duration = audio.duration;
                if (duration) {
                    audio.currentTime = (clickX / width) * duration;
                }
            });
            
            // --- Nút Lên Đầu Trang ---
            const backToTopBtn = document.getElementById('back-to-top');
            
            window.addEventListener('scroll', () => {
                if (window.pageYOffset > 300) {
                    backToTopBtn.classList.add('visible');
                } else {
                    backToTopBtn.classList.remove('visible');
                }
            });
            
            backToTopBtn.addEventListener('click', () => {
                window.scrollTo({
                    top: 0,
                    behavior: 'smooth'
                });
            });
            
            // --- Easter Egg: Click vào tên ---
            const birthdayGirl = document.getElementById('birthday-girl');
            
            birthdayGirl.addEventListener('click', () => {
                if (typeof confetti === 'function') {
                    confetti({
                        particleCount: 150,
                        spread: 70,
                        origin: { y: 0.6 }
                    });
                    
                    birthdayGirl.classList.add('glow-text');
                    setTimeout(() => {
                        birthdayGirl.classList.remove('glow-text');
                    }, 1000);
                }
            });
            
            // --- Trò chơi thổi nến bằng microphone ---
            const startMicBtn = document.getElementById('start-mic-btn');
            const blowResult = document.getElementById('blow-result');
            const candleCounter = document.getElementById('candle-counter');
            const blowSound = document.getElementById('blow-sound');
            const candleSound = document.getElementById('candle-sound');
            const micIcon = document.querySelector('.mic-icon');
            const micStatusText = document.getElementById('mic-status-text');
            const flames = [
                document.getElementById('flame-1'),
                document.getElementById('flame-2'),
                document.getElementById('flame-3')
            ];
            const blowMeter = document.querySelector('.blow-meter');
            const blowLevel = document.querySelector('.blow-level');
            
            let candlesBlown = 0;
            let audioContext;
            let analyser;
            let microphone;
            let isBlowing = false;
            let blowIntensity = 0;
            let maxBlowLevel = 0;
            let blowInterval;
            
            async function setupMicrophone() {
                try {
                    audioContext = new (window.AudioContext || window.webkitAudioContext)();
                    analyser = audioContext.createAnalyser();
                    analyser.fftSize = 256;
                    
                    const stream = await navigator.mediaDevices.getUserMedia({ audio: true, video: false });
                    microphone = audioContext.createMediaStreamSource(stream);
                    microphone.connect(analyser);
                    
                    micIcon.classList.add('active');
                    micStatusText.textContent = 'Sẵn sàng - hãy thổi mạnh!';
                    
                    // Ẩn nút bắt đầu thổi
                    startMicBtn.style.display = 'none';
                    
                    // Hiển thị thanh đo lực thổi
                    blowMeter.style.display = 'block';
                    
                    // Bắt đầu phân tích âm thanh
                    analyzeMicrophone();
                } catch (error) {
                    console.error("Lỗi truy cập microphone:", error);
                    micStatusText.textContent = 'Không thể truy cập microphone';
                    startMicBtn.textContent = 'Thử lại';
                    startMicBtn.disabled = false;
                }
            }
            
            function analyzeMicrophone() {
                if (!analyser) return;
                
                const bufferLength = analyser.frequencyBinCount;
                const dataArray = new Uint8Array(bufferLength);
                
                function checkBlowing() {
                    analyser.getByteFrequencyData(dataArray);
                    
                    // Tính toán cường độ âm thanh
                    let sum = 0;
                    for (let i = 0; i < bufferLength; i++) {
                        sum += dataArray[i];
                    }
                    const average = sum / bufferLength;
                    
                    // Cập nhật thanh đo lực thổi
                    const blowPercentage = Math.min(100, average);
                    blowLevel.style.width = `${blowPercentage}%`;
                    
                    // Nếu cường độ đủ mạnh (thổi)
                    if (average > 50) {
                        blowIntensity++;
                        
                        // Cập nhật giá trị thổi lớn nhất
                        if (average > maxBlowLevel) {
                            maxBlowLevel = average;
                        }
                        
                        // Phát âm thanh gió nếu chưa đang thổi
                        if (!isBlowing) {
                            isBlowing = true;
                            blowSound.currentTime = 0;
                            blowSound.play();
                        }
                    } else {
                        // Khi ngừng thổi
                        if (isBlowing) {
                            blowSound.pause();
                            
                            // Kiểm tra mức độ thổi
                            if (maxBlowLevel >= 130) {
                                blowOutCandles(3);
                            } else if (maxBlowLevel >= 100) {
                                blowOutCandles(2);
                            } else if (maxBlowLevel >= 60) {
                                blowOutCandles(1);
                            }
                            
                            // Reset các giá trị
                            maxBlowLevel = 0;
                            isBlowing = false;
                        }
                        blowIntensity = Math.max(0, blowIntensity - 0.5);
                    }
                    
                    requestAnimationFrame(checkBlowing);
                }
                
                checkBlowing();
            }
            
            function blowOutCandles(count) {
                let blown = 0;
                
                // Tắt nến theo số lượng yêu cầu
                for (let i = 0; i < flames.length && blown < count; i++) {
                    if (flames[i].style.display !== 'none') {
                        flames[i].style.display = 'none';
                        blown++;
                        candleSound.currentTime = 0;
                        candleSound.play();
                        candlesBlown++;
                    }
                }
                
                // Cập nhật đếm nến
                const remainingCandles = flames.length - candlesBlown;
                candleCounter.textContent = `Còn ${remainingCandles} cây nến cháy`;
                
                // Kiểm tra nếu tất cả nến đã tắt
                if (candlesBlown === flames.length) {
                    // Dừng microphone
                    if (microphone && microphone.mediaStream) {
                        microphone.mediaStream.getTracks().forEach(track => track.stop());
                    }
                    
                    // Hiển thị kết quả điều ước
                    blowResult.textContent = `Điều ước "${userWish}" đã thành sự thật ✨`;
                    blowResult.style.color = '#4CAF50';
                    
                    // Ẩn thanh đo lực và dòng đếm nến
                    blowMeter.style.display = 'none';
                    candleCounter.style.display = 'none';
                    
                    // Pháo hoa
                    if (typeof confetti === 'function') {
                        confetti({
                            particleCount: 150,
                            spread: 70,
                            origin: { y: 0.6 }
                        });
                    }
                    
                    // Reset sau 5 giây
                    setTimeout(() => {
                        flames.forEach(flame => flame.style.display = 'block');
                        candlesBlown = 0;
                        candleCounter.textContent = `Còn ${flames.length} cây nến cháy`;
                        candleCounter.style.display = 'block';
                        blowResult.textContent = '';
                        startMicBtn.style.display = 'inline-block';
                    }, 5000);
                } else {
                    blowResult.textContent = `Bạn đã thổi tắt ${blown} cây nến!`;
                    blowResult.style.color = '#f48fb1';
                    
                    // Reset sau 2 giây
                    setTimeout(() => {
                        blowResult.textContent = '';
                    }, 2000);
                }
            }
            
            startMicBtn.addEventListener('click', () => {
                startMicBtn.disabled = true;
                startMicBtn.textContent = 'Đang kết nối...';
                setupMicrophone();
            });
        });
    </script>
</body>
</html>
